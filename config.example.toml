# otlp2parquet Configuration File Example
# Copy this file to config.toml or .otlp2parquet.toml and customize for your environment
# Alternatively, use environment variables with the OTLP2PARQUET_ prefix

# ==============================================================================
# Batch Configuration (All Platforms)
# ==============================================================================
[batch]
# Maximum number of rows per batch before flushing
max_rows = 200_000

# Maximum bytes per batch before flushing (128 MB default)
max_bytes = 134_217_728

# Maximum age of batch in seconds before flushing
max_age_secs = 10

# Enable or disable batching entirely
enabled = true


# ==============================================================================
# Request Handling Configuration (All Platforms)
# ==============================================================================
[request]
# Maximum payload size in bytes (8 MB default)
max_payload_bytes = 8_388_608


# ==============================================================================
# Storage Configuration
# ==============================================================================
[storage]
# Storage backend type: "fs", "s3", or "r2"
# Platform defaults: Server=fs, Lambda=s3, Cloudflare=r2
backend = "fs"

# --- Filesystem Storage (backend="fs") ---
[storage.fs]
path = "./data"

# --- S3 Storage (backend="s3") ---
# [storage.s3]
# bucket = "my-otlp-bucket"
# region = "us-east-1"
# # Optional custom S3 endpoint (for S3-compatible services like MinIO)
# endpoint = "https://s3.custom-endpoint.com"

# --- R2 Storage (backend="r2") ---
# [storage.r2]
# bucket = "my-r2-bucket"
# account_id = "your_account_id"
# access_key_id = "your_access_key"
# secret_access_key = "your_secret_key"


# ==============================================================================
# Server-Specific Configuration (Server Platform Only)
# ==============================================================================
[server]
# HTTP server listen address
listen_addr = "0.0.0.0:4318"

# Log level: trace, debug, info, warn, error
log_level = "info"

# Log format: "text" (human-readable) or "json" (structured)
log_format = "text"


# ==============================================================================
# Lambda-Specific Configuration (Lambda Platform Only)
# ==============================================================================
[lambda]
# Enable integrated Iceberg writer (S3 Tables / Glue). When false, Lambda writes
# to S3 and performs optional post-write Iceberg commits.
integrated_iceberg = false


# ==============================================================================
# Cloudflare Workers-Specific Configuration (Cloudflare Platform Only)
# ==============================================================================
# [cloudflare]
# (Currently no cloudflare-specific config - uses common settings above)


# ==============================================================================
# Apache Iceberg Configuration (Optional - Lambda and Server Only)
# ==============================================================================
# Apache Iceberg provides ACID transactions, schema evolution, and faster queries
# for your OTLP data. When enabled, Parquet files are committed to an Iceberg
# catalog after being written to object storage.
#
# Note: Iceberg is NOT available in Cloudflare Workers to keep WASM binary size minimal.
#
# [iceberg]
# # Required: REST catalog endpoint URI
# # Examples:
# #   - AWS S3 Tables: "https://s3tables.us-east-1.amazonaws.com/iceberg"
# #   - AWS Glue: "https://glue.us-east-1.amazonaws.com/iceberg"
# rest_uri = "https://s3tables.us-east-1.amazonaws.com/iceberg"
#
# # Optional: Warehouse location (required for some catalogs like S3 Tables)
# warehouse = "s3://my-iceberg-warehouse"
#
# # Optional: Explicit data location for table storage (required for AWS Glue)
# # data_location = "s3://my-iceberg-warehouse"
#
# # Optional: Namespace for tables (dot-separated, e.g., "otel.production")
# # If not specified, tables will be created in the default namespace
# namespace = "otel.production"
#
# # Optional: Catalog name (default: "rest")
# catalog_name = "rest"
#
# # Optional: Staging prefix for data files (default: "data/incoming")
# staging_prefix = "data/incoming"
#
# # Optional: Target file size in bytes (default: 536870912 = 512 MB)
# target_file_size_bytes = 536_870_912
#
# # Optional: Iceberg format version (default: 2)
# format_version = 2
#
# # Optional: Custom table names (defaults shown)
# [iceberg.tables]
# logs = "otel_logs"
# traces = "otel_traces"
# metrics_gauge = "otel_metrics_gauge"
# metrics_sum = "otel_metrics_sum"
# metrics_histogram = "otel_metrics_histogram"
# metrics_exponential_histogram = "otel_metrics_exponential_histogram"
# metrics_summary = "otel_metrics_summary"
