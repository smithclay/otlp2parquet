# Cloudflare Workers configuration template for smoke tests
# Placeholders will be replaced by test harness at runtime

name = "{{WORKER_NAME}}"
main = "build/index.js"
compatibility_date = "2025-01-15"

workers_dev = true

[build]
command = "cargo install -q worker-build && worker-build --release"

[limits]
cpu_ms = 2000

[[r2_buckets]]
binding = "LOGS_BUCKET"
bucket_name = "{{BUCKET_NAME}}"

[vars]
# R2 Storage configuration (required)
OTLP2PARQUET_STORAGE_BACKEND = "r2"
OTLP2PARQUET_R2_BUCKET = "{{BUCKET_NAME}}"
CLOUDFLARE_ACCOUNT_ID = "{{CLOUDFLARE_ACCOUNT_ID}}"
OTLP2PARQUET_R2_ACCOUNT_ID = "{{CLOUDFLARE_ACCOUNT_ID}}"

# AWS standard credential variables (no prefix for AWS compatibility)
# Note: R2 always uses region="auto" - OpenDAL will use this automatically
AWS_REGION = "auto"
AWS_ACCESS_KEY_ID = "{{R2_ACCESS_KEY_ID}}"
AWS_SECRET_ACCESS_KEY = "{{R2_SECRET_ACCESS_KEY}}"
AWS_ENDPOINT_URL = "https://{{CLOUDFLARE_ACCOUNT_ID}}.r2.cloudflarestorage.com"

# Catalog mode: "iceberg" or "none" (plain Parquet)
OTLP2PARQUET_CATALOG_MODE = "{{CATALOG_MODE}}"

# R2 Data Catalog configuration (only used when OTLP2PARQUET_CATALOG_MODE = "iceberg")
CLOUDFLARE_BUCKET_NAME = "{{BUCKET_NAME}}"
CLOUDFLARE_API_TOKEN = "{{CLOUDFLARE_API_TOKEN}}"

[observability]
[observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true
persist = true
